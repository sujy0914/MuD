<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="global.css" />
    <link rel="stylesheet" href="style.css" />
</head>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  margin-top: 100px;
}
input {
  padding: 10px;
  margin: 5px;
  width: 200px;
}
button {
  padding: 10px 20px;
  margin-top: 10px;
}

.login-page {
  background-color: #ffffff;
    display: flex;
    flex-direction: row;
    justify-content: center;
    width: 100vw;
    height: 100vh;
    align-items: stretch;
    box-sizing: border-box;
    padding: 20px;
}

.login-page .div {
  background-color: #ffffff;
  width: 1440px;
  height: 1100px;
  position: relative;
}

.login-page .overlap-2 {
  position: absolute;
  width: 700px;
  height: 800px;
  top: 290px;
  left: 370px;
}

.login-page .rectangle {
  position: absolute;
  width: 650px; /* 확장 */
  height: 600px; /* 확장 */
  top: 50px;
  left: 0;
  background-color: #fbf6f6;
}

.login-page .text-wrapper-2 {
  position: absolute;
  width: 200px;
  top: 0px;
  left: -50px;
  font-family: "Pathway Extreme-Light", Helvetica;
  font-weight: 300;
  color: #0000008a;
  font-size: 34px;
  letter-spacing: 0;
  line-height: normal;
}

.rectangle-input {
  position: absolute;
  width: 550px; /* 너비 증가 */
  height: 80px;  /* 높이 증가 */
  padding: 0px 10px;
  font-size: 27px;
  font-family: "Playfair Display-Regular", Helvetica;
  color: #000;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
}

.rectangle-input::placeholder {
  color: #aaa;
}

input#userId { top: 150px; left: 33px; }
input#password { top: 270px; left: 33px; }


.find{
    position: absolute;
    top: 350px;
    left: 405px;
    color: #888888cc;
    cursor: pointer;
    background: none;
    border: none;
    outline: none;
    font-size: 20px;
    padding: 8px 12px;
}

.login-button {
  position: absolute;
  top: 470px;
  left: 46%;
  transform: translateX(-50%);
  width: 250px;
  height: 70px;
  line-height: 70px;
  background-color: #bc878791;
  color: #fff;
  font-size: 32px;
  text-align: center;
  border-radius: 6px;
  cursor: pointer;
}

.googleLoginBtn {
  position: absolute;
  top: 550px;
  left: 46%;
  transform: translateX(-50%);
  width: 250px;
  height: 70px;
  padding: 0;
}

#nav-buttons {
    position: absolute;
    top: 60px;
    right: 50px;
    font-size: 30px;
    z-index: 1000;
}
#nav-buttons a {
  margin-left: 15px;
  text-decoration: none;
  color: #333;
  font-weight: bold;
}

.clickable {
  cursor: pointer;
}

.downscaled-wrapper {
  position: relative;
  display: inline-block;
  left: -50%;
  transform: translateY(0px) scale(1.1);
}

.gsi-material-button {
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  -webkit-appearance: none;
  background-color: white;
  background-image: none;
  border: 1px solid #f0f0f0;
  border-radius: 6px;
  -webkit-box-sizing: border-box;
  box-sizing: border-box;
  color: #1f1f1f;
  cursor: pointer;
  font-family: 'Roboto', arial, sans-serif;
  font-size: 20px;
  letter-spacing: 0.25px;
  outline: none;
  overflow: hidden;
  padding: 0 12px;
  text-align: center;
  -webkit-transition: background-color .218s, border-color .218s, box-shadow .218s;
  transition: background-color .218s, border-color .218s, box-shadow .218s;
  vertical-align: middle;
  white-space: nowrap;
  /* 위치, 크기 관련 제거:
  height, width, max-width, min-width, position, etc. 삭제 */
}

.gsi-material-button .gsi-material-button-icon {
  height: 20px;
  margin-right: 12px;
  min-width: 20px;
  width: 20px;
}

.gsi-material-button .gsi-material-button-content-wrapper {
  -webkit-align-items: center;
  align-items: center;
  display: flex;
  -webkit-flex-direction: row;
  flex-direction: row;
  -webkit-flex-wrap: nowrap;
  flex-wrap: nowrap;
  height: 100%;
  justify-content: space-between;
  position: relative;
  width: 100%;
}

.gsi-material-button .gsi-material-button-contents {
  -webkit-flex-grow: 1;
  flex-grow: 1;
  font-family: 'Roboto', arial, sans-serif;
  font-weight: 500;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: top;
}

.gsi-material-button .gsi-material-button-state {
  -webkit-transition: opacity .218s;
  transition: opacity .218s;
  bottom: 0;
  left: 0;
  opacity: 0;
  position: absolute;
  right: 0;
  top: 0;
}

.gsi-material-button:disabled {
  cursor: default;
  background-color: #ffffff61;
  border-color: #1f1f1f1f;
}

.gsi-material-button:disabled .gsi-material-button-contents {
  opacity: 38%;
}

.gsi-material-button:disabled .gsi-material-button-icon {
  opacity: 38%;
}

.gsi-material-button:not(:disabled):active .gsi-material-button-state,
.gsi-material-button:not(:disabled):focus .gsi-material-button-state {
  background-color: #303030;
  opacity: 12%;
}

.gsi-material-button:not(:disabled):hover {
  -webkit-box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .30), 0 1px 3px 1px rgba(60, 64, 67, .15);
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .30), 0 1px 3px 1px rgba(60, 64, 67, .15);
}

.gsi-material-button:not(:disabled):hover .gsi-material-button-state {
  background-color: #303030;
  opacity: 8%;
}

.modal {
  position: fixed;
  top: 100px; left: -20px;
  width: 1440px; height: 1100px;
  display: flex; justify-content: center; align-items: center;
  z-index: 9999;
}

.modal-content {
  background: white;
  width: 500px;
  height: 400px;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  font-size: 16px;
}

.tabs {
  display: flex;
  margin-bottom: 10px;
}

.tab {
  flex: 1;
  padding: 10px;
  border: none;
  background: #eee;
  cursor: pointer;
  font-size: 15px;
}

.tab.active {
  background: white;
  font-weight: bold;
  border-bottom: 3px solid #fbf6f6;
}

.form {
  flex: 1;
  overflow-y: auto;
}

.form input {
  width: 70%;
  padding: 10px;
  margin: 10px 0;
  font-size: 20px;
  box-sizing: border-box;
}

.form button {
  width: 70%;
  padding: 12px;
  background: #e9d7d7;
  border: none;
  color: white;
  cursor: pointer;
  font-weight: bold;
  font-size: 15px;
  margin-top: 10px;
}

.hidden {
  display: none;
}

</style>
<body>
<div class="login-page">
    <div class="div">
        <div id="nav-buttons"></div>
        <div id="header"></div>
        <div class="downscaled-wrapper">
        <div class="overlap-2">
            <div class="rectangle"></div>
            <div class="text-wrapper-2">Login</div>
            <input id="userId" class="rectangle-input" type="text" placeholder="ID" />
            <input id="password" class="rectangle-input" type="password" placeholder="Password" />
            <!-- 버튼 -->
            <button class="find" id="find">아이디/비밀번호 찾기</button>
            <!-- 모달 배경 -->
            <div id="find-modal" class="modal hidden">
                <div class="modal-content">
                    <div class="tabs">
                        <button class="tab active" data-tab="id">아이디 찾기</button>
                        <button class="tab" data-tab="password">비밀번호 찾기</button>
                    </div>
                    <div class="form" id="id-form">
                        <input type="text" id="id-name" placeholder="이름">
                        <input type="email" id="id-email" placeholder="이메일">
                        <button id="submit-id">아이디 찾기</button>
                    </div>
                    <div class="form hidden" id="password-form">
                        <input type="text" id="pw-name" placeholder="이름">
                        <input type="text" id="pw-id" placeholder="아이디">
                        <input type="email" id="pw-email" placeholder="이메일">
                        <button id="submit-password">비밀번호 찾기</button>
                    </div>
                </div>
            </div>
            <div id="loginButton" class="login-button">Login</div>
            <button class="googleLoginBtn gsi-material-button" id="googleLoginBtn" aria-label="Google Login">
                <div class="gsi-material-button-state"></div>
                <div class="gsi-material-button-content-wrapper">
                    <div class="gsi-material-button-icon">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" style="display: block;">
                            <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                            <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                            <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                            <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                            <path fill="none" d="M0 0h48v48H0z"></path>
                        </svg>
                    </div>
                    <span class="gsi-material-button-contents">Sign in with Google</span>
                    <span style="display: none;">Sign in with Google</span>
                </div>
            </button>
        </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", () => {
      // header.html 삽입
      fetch('header.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('header').innerHTML = data;
          checkLoginStatus();
        });

      function checkLoginStatus() {
        fetch('http://localhost:8080/api/users/check-login', {
          method: 'GET',
          credentials: 'include'
        })
          .then(response => response.json())
          .then(data => {
            const navButtons = document.getElementById("nav-buttons");

            if (data.isLoggedIn) {
              navButtons.innerHTML = `
                <a href="mypage.html">MyPage</a>
                <a href="#" id="logoutBtn">Logout</a>
              `;
              document.getElementById("logoutBtn").addEventListener("click", (event) => {
                event.preventDefault();
                fetch('http://localhost:8080/api/users/logout', {
                  method: 'GET',
                  credentials: 'include'
                }).then(response => {
                  if (response.ok) {
                    alert("로그아웃 되었습니다.");
                    window.location.href = "main.html";
                  } else {
                    alert("로그아웃 실패");
                  }
                });
              });
            } else {
              navButtons.innerHTML = `
                <a href="join.html">Join</a>
                <a href="login.html">Login</a>
              `;
            }
          })
          .catch(() => {
            document.getElementById("nav-buttons").innerHTML = `
              <a href="join.html">Join</a>
              <a href="login.html">Login</a>
            `;
          });
      }

      // 일반 로그인 처리
      const userIdInput = document.getElementById('userId');
      const passwordInput = document.getElementById('password');
      const loginButton = document.getElementById('loginButton');

      passwordInput?.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          loginButton.click();
        }
      });

      loginButton?.addEventListener('click', async function () {
        const userId = userIdInput.value.trim();
        const password = passwordInput.value.trim();

        if (!userId || !password) {
          alert('아이디와 비밀번호를 입력해야 합니다.');
          return;
        }

        try {
          const response = await fetch('http://localhost:8080/api/users/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId, password }),
            credentials: 'include'
          });

          const result = await response.json();

          if (response.ok) {
            alert('로그인 성공!');
            sessionStorage.setItem('userId', userId);
            window.location.href = "main.html";
          } else {
            alert('로그인 실패: ' + (result.message || '알 수 없는 오류'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('아이디 또는 비밀번호를 확인해주세요.');
        }
      });

      // ✅ 아이디/비밀번호 찾기 모달 로직
      const findBtn = document.getElementById('find');
      const modal = document.getElementById('find-modal');
      const tabs = document.querySelectorAll('.tab');
      const forms = {
        id: document.getElementById('id-form'),
        password: document.getElementById('password-form')
      };

      findBtn?.addEventListener('click', () => {
        modal.classList.remove('hidden');
      });

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          forms.id.classList.add('hidden');
          forms.password.classList.add('hidden');
          forms[tab.dataset.tab].classList.remove('hidden');
        });
      });

      document.getElementById('submit-id')?.addEventListener('click', async () => {
        const name = document.getElementById('id-name').value;
        const email = document.getElementById('id-email').value;
        if (!name || !email) return alert("이름과 이메일을 모두 입력해주세요.");

        try {
          const res = await fetch('http://localhost:8080/api/users/find-id', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email }),
            credentials: 'include'
          });
          const data = await res.json();
          alert(data.success ? '아이디를 이메일로 발송했습니다.' : (data.message || '정보가 일치하지 않습니다.'));
        } catch {
          alert('오류가 발생했습니다.');
        }
      });

      document.getElementById('submit-password')?.addEventListener('click', async () => {
        const name = document.getElementById('pw-name').value;
        const userId = document.getElementById('pw-id').value;
        const email = document.getElementById('pw-email').value;
        if (!name || !userId || !email) return alert("모든 정보를 입력해주세요.");

        try {
          const res = await fetch('http://localhost:8080/api/users/find-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, userId, email }),
            credentials: 'include'
          });
          const data = await res.json();
          alert(data.success ? '임시 비밀번호를 이메일로 보냈습니다.' : (data.message || '정보가 일치하지 않습니다.'));
        } catch {
          alert('오류가 발생했습니다.');
        }
      });

      // ✅ 구글 로그인 처리
      document.getElementById("googleLoginBtn")?.addEventListener("click", () => {
        const clientId = '318299485693-o1mgilivugkp0huk124bo2hjfe6ci3s2.apps.googleusercontent.com';
        const redirectUri = 'http://localhost:8080/oauth/google';

        const url = 'https://accounts.google.com/o/oauth2/v2/auth?' + new URLSearchParams({
          client_id: clientId,
          redirect_uri: redirectUri,
          response_type: 'code',
          scope: 'openid email profile',
          access_type: 'offline',
          prompt: 'consent'
        });
        window.location.href = url;
      });
    });
</script>
</body>
</html>
